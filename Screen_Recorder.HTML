<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Screen Recorder</title>
    <style>
        /* ---------------------------------------------------- */
        /* ØªØ¹Ø±ÛŒÙ Ø®Ø§Ù†ÙˆØ§Ø¯Ù‡ ÙÙˆÙ†Øª Ú©Ù„Ù…Ù‡ (Kalameh) */
        /* ---------------------------------------------------- */

        @font-face {
            font-family: 'Kalameh';
            src: url('fonts/Kalameh-Thin.woff2') format('woff2'),
                 url('fonts/Kalameh-Thin.woff') format('woff');
            font-weight: 100;
            font-style: normal;
        }
        @font-face {
            font-family: 'Kalameh';
            src: url('fonts/Kalameh-Light.woff2') format('woff2'),
                 url('fonts/Kalameh-Light.woff') format('woff');
            font-weight: 300;
            font-style: normal;
        }
        @font-face {
            font-family: 'Kalameh';
            src: url('fonts/Kalameh-Regular.woff2') format('woff2'),
                 url('fonts/Kalameh-Regular.woff') format('woff');
            font-weight: 400; 
            font-style: normal;
        }
        @font-face {
            font-family: 'Kalameh';
            src: url('fonts/Kalameh-Medium.woff2') format('woff2'),
                 url('fonts/Kalameh-Medium.woff') format('woff');
            font-weight: 500;
            font-style: normal;
        }
        @font-face {
            font-family: 'Kalameh';
            src: url('fonts/Kalameh-Bold.woff2') format('woff2'),
                 url('fonts/Kalameh-Bold.woff') format('woff');
            font-weight: 700; 
            font-style: normal;
        }
        @font-face {
            font-family: 'Kalameh';
            src: url('fonts/Kalameh-Black.woff2') format('woff2'),
                 url('fonts/Kalameh-Black.woff') format('woff');
            font-weight: 900;
            font-style: normal;
        }

        /* ---------------------------------------------------- */
        /* ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§ØµÙ„ÛŒ Ùˆ Ù…ØªØºÛŒØ±Ù‡Ø§ */
        /* ---------------------------------------------------- */

        :root {
            /* 
               [ØªÙˆØ¶ÛŒØ­Ø§Øª ØªØµÙˆÛŒØ± Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡]
               Ø¨Ø±Ø§ÛŒ ØªØºÛŒÛŒØ± ØªØµÙˆÛŒØ± Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ØŒ ÙØ§ÛŒÙ„ Ø®ÙˆØ¯ Ø±Ø§ Ø¯Ø± Ù¾ÙˆØ´Ù‡ Image Ù‚Ø±Ø§Ø± Ø¯Ù‡ÛŒØ¯.
            */
            --bg-image: url('Image/background.png'); 

            /* 
               -------------------------------------------------------
               [ØªÙˆØ¶ÛŒØ­Ø§Øª Ù„ÙˆÚ¯Ùˆ / Ø¹Ú©Ø³ Ù¾Ø±ÙˆÙØ§ÛŒÙ„]
               Ø¨Ø±Ø§ÛŒ ØªØºÛŒÛŒØ± Ù„ÙˆÚ¯ÙˆØŒ ÙØ§ÛŒÙ„ Ø¹Ú©Ø³ Ø®ÙˆØ¯ Ø±Ø§ Ø¯Ø± Ù¾ÙˆØ´Ù‡ Image Ù‚Ø±Ø§Ø± Ø¯Ù‡ÛŒØ¯.
               Ø³Ù¾Ø³ Ù†Ø§Ù… ÙØ§ÛŒÙ„ Ø±Ø§ Ø¯Ø± Ú©Ø¯ HTML (Ø¯Ø§Ø®Ù„ ØªÚ¯ img Ú©Ù‡ Ú©Ø§Ù…Ù†Øª Ú¯Ø°Ø§Ø´ØªÙ‡â€ŒØ§Ù…) Ú†Ú© Ú©Ù†ÛŒØ¯.
               
               Ù…Ø³ÛŒØ± Ù¾ÛŒØ´â€ŒÙØ±Ø¶ ÙØ¹Ù„ÛŒ: Image/logo.png
               
               Ø§Ø¨Ø¹Ø§Ø¯ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ: Ù…Ø±Ø¨Ø¹ Ú©Ø§Ù…Ù„ (Ù…Ø«Ù„Ø§Ù‹ 200 Ø¯Ø± 200 Ù¾ÛŒÚ©Ø³Ù„ ÛŒØ§ 512 Ø¯Ø± 512).
               ÙØ±Ù…Øªâ€ŒÙ‡Ø§ÛŒ Ù…Ø¬Ø§Ø²: PNG (Ø¨Ø¯ÙˆÙ† Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ Ø¨Ø±Ø§ÛŒ Ø²ÛŒØ¨Ø§ÛŒÛŒ Ø¨ÛŒØ´ØªØ±) ÛŒØ§ JPG.
               -------------------------------------------------------
            */

            --primary-color: #1950a8;
            --accent-color: #0c8b61;
            --danger-color: #ac1d1d;
        }

        body {
            font-family: 'Kalameh', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-weight: 400; 
            background: #1e293b var(--bg-image) no-repeat center center fixed;
            background-size: cover;
            margin: 0;
            display: flex;
            justify-content: center;
            
            align-items: flex-start; /* Ø¨Ù‡ Ø¬Ø§ÛŒ center Ø§Ø² flex-start Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø´Ø¯ ØªØ§ Ø¨Ø§Ù„Ø§ Ù‚ÙÙ„ Ù†Ø´ÙˆØ¯ */
            padding-top: 80px;       /* ÙØ§ØµÙ„Ù‡ Ø§Ø² Ø¨Ø§Ù„Ø§ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ù„ÙˆÚ¯Ùˆ */
            padding-bottom: 80px;    /* ÙØ§ØµÙ„Ù‡ Ø§Ø² Ù¾Ø§ÛŒÛŒÙ† Ø¨Ø±Ø§ÛŒ Ø§Ø³Ú©Ø±ÙˆÙ„ Ø±Ø§Ø­Øª */
            min-height: 100vh;       /* Ø­Ø¯Ø§Ù‚Ù„ Ø§Ø±ØªÙØ§Ø¹ Ú©Ù„ ØµÙØ­Ù‡ */
            box-sizing: border-box;  /* Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¯Ù‚ÛŒÙ‚ Ù¾Ø¯ÛŒÙ†Ú¯ */
            overflow-y: auto;        /* ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ø§Ø³Ú©Ø±ÙˆÙ„ Ø¹Ù…ÙˆØ¯ÛŒ */
            /* ----------------------------------- */
            
            color: #fff;
        }

        .overlay {
            background: rgba(15, 23, 42, 0.85); 
            backdrop-filter: blur(12px);
            padding: 50px 30px 30px 30px;
            border-radius: 24px;
            width: 90%;
            max-width: 650px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.6);
            border: 1px solid rgba(255,255,255,0.1);
            position: relative;
            /* Ù…Ø§Ø±Ø¬ÛŒÙ† Ø®ÙˆØ¯Ú©Ø§Ø± Ø¨Ø±Ø§ÛŒ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø§Ø² ÙˆØ³Ø· Ú†ÛŒÙ† Ø´Ø¯Ù† Ø¯Ø± Ø­Ø§Ù„Øª ÙÙ„Ú©Ø³ */
            margin: auto 0; 
        }

        .logo-container {
            position: absolute;
            top: -50px;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 100px;
            background: #fff;
            border-radius: 25px;
            padding: 5px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.4);
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .logo-container img {
            max-width: 90%;
            max-height: 90%;
            object-fit: contain;
        }

        .header { margin-top: 30px; text-align: center; }
        .header h2 { font-weight: 700; margin-bottom: 10px; }

        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 20px 0; }
        .control-item { display: flex; flex-direction: column; text-align: right; }
        
        label { 
            font-size: 14px; 
            margin-bottom: 5px; 
            color: #cbd5e1; 
            font-weight: 500; 
        }
        
        select {
            padding: 12px;
            border-radius: 10px;
            border: 1px solid rgba(255,255,255,0.2);
            background: rgba(0,0,0,0.3);
            color: white;
            outline: none;
            cursor: pointer;
            font-family: inherit; 
        }
        select option { background: #1e293b; font-family: inherit; }

        .btn-main {
            width: 100%;
            padding: 15px;
            border-radius: 12px;
            border: none;
            font-family: inherit;
            font-weight: 700; 
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
            margin-top: 10px;
        }

        #startBtn { background: var(--primary-color); color: white; box-shadow: 0 4px 15px rgba(59, 130, 246, 0.4); }
        #startBtn:hover { transform: translateY(-2px); background: #2563eb; }

        #stopBtn { background: var(--danger-color); color: white; display: none; }
        
        #downloadBtn { 
            background: var(--accent-color); 
            color: white; 
            opacity: 0.2; 
            cursor: not-allowed;
            margin-top: 15px;
        }
        #downloadBtn.active { opacity: 1; cursor: pointer; box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4); }

        #pauseBtn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: #f59e0b;
            color: white;
            border: 4px solid rgba(255,255,255,0.2);
            cursor: pointer;
            box-shadow: 0 8px 20px rgba(0,0,0,0.4);
            display: none;
            z-index: 1000;
            font-size: 28px;
            transition: 0.2s;
        }
        #pauseBtn:hover { transform: scale(1.1); }

        .social-info {
            margin-top: 25px;
            padding-top: 20px;
            border-top: 1px solid rgba(255,255,255,0.1);
            font-size: 14px;
            text-align: center;
            line-height: 1.8;
            font-weight: 300; 
        }
        
        .social-links-container {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 15px;
            margin-top: 10px;
        }

        .social-item {
            display: flex;
            align-items: center;
            gap: 5px;
            background: rgba(255,255,255,0.05);
            padding: 5px 12px;
            border-radius: 50px;
            transition: 0.3s;
        }
        .social-item:hover { background: rgba(255,255,255,0.15); transform: translateY(-2px); }
        .social-item svg { width: 18px; height: 18px; fill: white; }
        .social-item a { color: #fff; text-decoration: none; font-weight: 500; font-size: 13px; }

        .donation-link {
            display: inline-block;
            margin-top: 5px;
            padding: 8px 25px;
            background: #ac1d1d;
            border-radius: 25px;
            color: white !important;
            font-weight: 700;
            text-decoration: none;
            transition: 0.3s;
            box-shadow: 0 4px 10px rgba(172, 29, 29, 0.4);
        }
        .donation-link:hover { background: #ec4899; transform: scale(1.05); }

        .timer-box { 
            font-size: 24px; 
            color: #fbbf24; 
            margin: 10px 0; 
            display: none; 
            font-weight: 700; 
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
            font-family: 'Segoe UI', sans-serif; 
        }

        /* Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ ÙˆØ¨â€ŒÚ©Ù… */
        #webcamContainer {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 9999;
            width: 200px;
            height: 150px;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            border: 2px solid #fff;
            display: none; /* Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ù…Ø®ÙÛŒ */
            cursor: grab;
        }
        #webcamContainer:active { cursor: grabbing; border-color: var(--accent-color); }
        #webcamVideo {
            width: 100%;
            height: 100%;
            object-fit: cover;
            background: #000;
        }
        /* Ú©Ù„Ø§Ø³â€ŒÙ‡Ø§ÛŒ Ø´Ú©Ù„ ÙˆØ¨â€ŒÚ©Ù… */
        .shape-rect { border-radius: 12px; width: 220px !important; height: 165px !important; }
        .shape-square { border-radius: 12px; width: 200px !important; height: 200px !important; }
        .shape-circle { border-radius: 50%; width: 200px !important; height: 200px !important; }
    </style>
</head>
<body>

    <!-- Ú©Ø§Ù†ØªÛŒÙ†Ø± ÙˆØ¨â€ŒÚ©Ù… Ú©Ù‡ Ø±ÙˆÛŒ ØµÙØ­Ù‡ Ø´Ù†Ø§ÙˆØ± Ø§Ø³Øª -->
    <div id="webcamContainer">
        <video id="webcamVideo" autoplay muted></video>
    </div>

    <button id="pauseBtn" title="ØªÙˆÙ‚Ù Ù…ÙˆÙ‚Øª/Ø§Ø¯Ø§Ù…Ù‡">â¸</button>

    <div class="overlay">
        <div class="logo-container">
            <!-- 
               [Ù…Ø­Ù„ Ù‚Ø±Ø§Ø±Ú¯ÛŒØ±ÛŒ ÙØ§ÛŒÙ„ Ù„ÙˆÚ¯Ùˆ]
               Ø¹Ú©Ø³ Ø®ÙˆØ¯ Ø±Ø§ Ø¯Ø± Ù¾ÙˆØ´Ù‡ Image Ø¨Ú¯Ø°Ø§Ø±ÛŒØ¯ Ùˆ Ù†Ø§Ù… Ø¢Ù† Ø±Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯.
               Ù¾ÛŒØ´â€ŒÙØ±Ø¶: Image/logo.png
            -->
            <img src="Image/logo.png" alt="Logo" onerror="this.src='https://cdn-icons-png.flaticon.com/512/3227/3227008.png'">
        </div>

        <div class="header">
            <h2> Ø§Ø³Ú©Ø±ÛŒÙ† Ø±Ú©ÙˆØ±Ø¯Ø± Ù¾ÛŒØ´Ø±ÙØªÙ‡ - Advanced Screen Recorder </h2>
            <div id="timer" class="timer-box">00:00</div>
        </div>

        <div class="grid">
            <div class="control-item">
                <label>Ú©ÛŒÙÛŒØª ØªØµÙˆÛŒØ±:</label>
                <select id="videoQuality">
                    <option value="1500000">Low (720p)</option>
                    <option value="4500000" selected>Medium (1080p)</option>
                    <option value="12000000">High (4K Crystal)</option>
                </select>
            </div>
            <div class="control-item">
                <label>ÙØ±Ù…Øª Ø¯Ø§Ù†Ù„ÙˆØ¯:</label>
                <select id="outputFormat">
                    <option value="webm">WebM (Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯)</option>
                    <option value="mp4">MP4 (Ø³Ø§Ø²Ú¯Ø§Ø±)</option>
                    <option value="mkv">MKV (Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ)</option>
                </select>
            </div>
            
            <div class="control-item">
                <label>ÙˆØ±ÙˆØ¯ÛŒ ØµØ¯Ø§:</label>
                <select id="micSelect">
                    <option value="mute">ğŸ”‡ Ø¨Ø¯ÙˆÙ† Ø¶Ø¨Ø· ØµØ¯Ø§</option>
                    <option value="false">ÙÙ‚Ø· ØµØ¯Ø§ÛŒ Ø³ÛŒØ³ØªÙ…</option>
                    <option value="true">Ø³ÛŒØ³ØªÙ… + Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ†</option>
                </select>
            </div>
            <div class="control-item">
                <label>ØªØ§ÛŒÙ…Ø± ØªÙˆÙ‚Ù Ø®ÙˆØ¯Ú©Ø§Ø±:</label>
                <select id="timeLimit">
                    <option value="0">Ø¨ÛŒâ€ŒÙ†Ù‡Ø§ÛŒØª</option>
                    <option value="600000">10 Ø¯Ù‚ÛŒÙ‚Ù‡</option>
                    <option value="1800000">30 Ø¯Ù‚ÛŒÙ‚Ù‡</option>
                    <option value="3600000">60 Ø¯Ù‚ÛŒÙ‚Ù‡</option>
                </select>
            </div>

            <!-- Ø¨Ø®Ø´ ØªÙ†Ø¸ÛŒÙ…Ø§Øª ÙˆØ¨â€ŒÚ©Ù… -->
            <div class="control-item">
                <label>ÙˆØ¶Ø¹ÛŒØª ÙˆØ¨â€ŒÚ©Ù…:</label>
                <select id="webcamToggle">
                    <option value="off">Ø®Ø§Ù…ÙˆØ´</option>
                    <option value="on">Ø±ÙˆØ´Ù†</option>
                </select>
            </div>
            <div class="control-item">
                <label>Ø´Ú©Ù„ ÙˆØ¨â€ŒÚ©Ù…:</label>
                <select id="webcamShape">
                    <option value="rect">Ù…Ø³ØªØ·ÛŒÙ„</option>
                    <option value="square">Ù…Ø±Ø¨Ø¹</option>
                    <option value="circle">Ø¯Ø§ÛŒØ±Ù‡</option>
                </select>
            </div>
        </div>

        <button id="startBtn" class="btn-main">Screen Recording ğŸ”´ Ø´Ø±ÙˆØ¹ Ø¶Ø¨Ø· ØµÙØ­Ù‡</button>
        <button id="stopBtn" class="btn-main">Stop Recording âŒ ØªÙˆÙ‚Ù Ø¶Ø¨Ø·</button>
        
        <button id="downloadBtn" class="btn-main" disabled>Ø¯Ø§Ù†Ù„ÙˆØ¯ ÙØ§ÛŒÙ„ ÙˆÛŒØ¯ÛŒÙˆ ğŸ“¥ Download video file</button>

        <div class="social-info">
            <div>Ø´Ø¨Ú©Ù‡â€ŒÙ‡Ø§ÛŒ Ø§Ø¬ØªÙ…Ø§Ø¹ÛŒ Ù…Ù†:</div>
            
            <div class="social-links-container">
                <!-- Ù„ÛŒÙ†Ú© ØªÙ„Ú¯Ø±Ø§Ù… -->
                <div class="social-item">
                    <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm4.64 6.8c-.15 1.58-.8 5.42-1.13 7.19-.14.75-.42 1-.68 1.03-.58.05-1.02-.38-1.58-.75-.88-.58-1.38-.94-2.23-1.5-.99-.65-.35-1.01.22-1.59.15-.15 2.71-2.48 2.76-2.69.01-.03.01-.14-.07-.2-.08-.06-.19-.04-.27-.02-.12.02-1.96 1.25-5.54 3.69-.52.36-1 .53-1.42.52-.47-.01-1.37-.26-2.03-.48-.82-.27-1.47-.42-1.42-.88.03-.24.37-.49 1.03-.75 4.04-1.76 6.74-2.92 8.09-3.48 3.85-1.6 4.64-1.88 5.17-1.88.11 0 .37.03.54.17.14.12.18.28.2.45-.02.07-.02.13-.03.22z"/></svg>
                    <!-- !!! Ù„ÛŒÙ†Ú© ØªÙ„Ú¯Ø±Ø§Ù… Ø®ÙˆØ¯ Ø±Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ø¨Ú¯Ø°Ø§Ø±ÛŒØ¯ !!! -->
                    <a href="https://t.me/EngineerHt" target="_blank">Telegram</a> 
                </div>

                <!-- Ù„ÛŒÙ†Ú© Ø§ÛŒÙ†Ø³ØªØ§Ú¯Ø±Ø§Ù… -->
                <div class="social-item">
                    <svg viewBox="0 0 24 24"><path d="M7.8 2h8.4C19.4 2 22 4.6 22 7.8v8.4a5.8 5.8 0 0 1-5.8 5.8H7.8C4.6 22 2 19.4 2 16.2V7.8A5.8 5.8 0 0 1 7.8 2m-.2 2A3.6 3.6 0 0 0 3.8 7.6v8.8A3.6 3.6 0 0 0 7.6 20h8.8a3.6 3.6 0 0 0 3.8-3.8V7.6A3.6 3.6 0 0 0 16.4 4H7.6m9.65 1.5a1.25 1.25 0 0 1 1.25 1.25A1.25 1.25 0 0 1 17.25 8 1.25 1.25 0 0 1 16 6.75a1.25 1.25 0 0 1 1.25-1.25M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3z"/></svg>
                    <!-- !!! Ù„ÛŒÙ†Ú© Ø§ÛŒÙ†Ø³ØªØ§Ú¯Ø±Ø§Ù… Ø®ÙˆØ¯ Ø±Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ø¨Ú¯Ø°Ø§Ø±ÛŒØ¯ !!! -->
                    <a href="https://www.instagram.com/ho3seintork?igsh=MTkwdDNxaWtqcGs3aA==" target="_blank">Instagram</a>
                </div>

                <!-- Ù„ÛŒÙ†Ú© ØªÙˆÛŒÛŒØªØ± -->
                <div class="social-item">
                    <svg viewBox="0 0 24 24"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
                    <!-- !!! Ù„ÛŒÙ†Ú© ØªÙˆÛŒÛŒØªØ± Ø®ÙˆØ¯ Ø±Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ø¨Ú¯Ø°Ø§Ø±ÛŒØ¯ !!! -->
                    <a href="https://x.com/ho3seintork" target="_blank">Twitter (X)</a>
                </div>
            </div>

            <!-- !!! Ù„ÛŒÙ†Ú© Ù¾Ø±Ø¯Ø§Ø®Øª/Ø¯ÙˆÙ†ÛŒØ´Ù† Ø®ÙˆØ¯ Ø±Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ø¨Ú¯Ø°Ø§Ø±ÛŒØ¯ !!! -->
            <a href="https://reymit.ir/ho3seintork" class="donation-link" target="_blank">â˜• Ø­Ù…Ø§ÛŒØª Ù…Ø§Ù„ÛŒ (Donation)</a>
        </div>
    </div>

    <script>
        let mediaRecorder;
        let recordedChunks = [];
        let startTime;
        let timerInterval;
        let finalBlob;
        let pauseStartTime = 0;
        let totalPausedTime = 0;
        let webcamStream = null;

        const startBtn = document.getElementById('startBtn');
        const stopBtn = document.getElementById('stopBtn');
        const downloadBtn = document.getElementById('downloadBtn');
        const pauseBtn = document.getElementById('pauseBtn');
        const timerDisplay = document.getElementById('timer');
        
        // Ø§Ù„Ù…Ø§Ù†â€ŒÙ‡Ø§ÛŒ ÙˆØ¨â€ŒÚ©Ù…
        const webcamContainer = document.getElementById('webcamContainer');
        const webcamVideo = document.getElementById('webcamVideo');
        const webcamToggle = document.getElementById('webcamToggle');
        const webcamShape = document.getElementById('webcamShape');

        startBtn.onclick = async () => {
            recordedChunks = [];
            totalPausedTime = 0;
            downloadBtn.classList.remove('active');
            downloadBtn.disabled = true;

            try {
                // 1. ØªÙ†Ø¸ÛŒÙ… ÙˆØ¨â€ŒÚ©Ù… Ø§Ú¯Ø± Ø±ÙˆØ´Ù† Ø¨Ø§Ø´Ø¯
                if (webcamToggle.value === 'on') {
                    try {
                        webcamStream = await navigator.mediaDevices.getUserMedia({ video: true, audio: false });
                        webcamVideo.srcObject = webcamStream;
                        webcamContainer.style.display = 'block';
                        updateWebcamShape();
                    } catch (err) {
                        alert("Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ ÙˆØ¨â€ŒÚ©Ù… Ø¯Ø§Ø¯Ù‡ Ù†Ø´Ø¯ ÛŒØ§ Ø®Ø·Ø§ÛŒÛŒ Ø±Ø® Ø¯Ø§Ø¯.");
                        console.error(err);
                    }
                } else {
                    webcamContainer.style.display = 'none';
                }

                // 2. Ø¯Ø±ÛŒØ§ÙØª ØªØµÙˆÛŒØ± ØµÙØ­Ù‡
                const displayStream = await navigator.mediaDevices.getDisplayMedia({
                    video: { frameRate: 30 },
                    audio: true
                });

                let finalStream = displayStream;
                const audioOption = document.getElementById('micSelect').value;

                // 3. Ù…Ø¯ÛŒØ±ÛŒØª ØµØ¯Ø§ (Ø¨Ø¯ÙˆÙ† ØµØ¯Ø§ / Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ† / Ø³ÛŒØ³ØªÙ…)
                if (audioOption === "mute") {
                    // Ø­Ø°Ù ØªÙ…Ø§Ù… ØªØ±Ú©â€ŒÙ‡Ø§ÛŒ ØµÙˆØªÛŒ Ø§Ø² Ø§Ø³ØªØ±ÛŒÙ… Ù†Ù‡Ø§ÛŒÛŒ
                    finalStream = new MediaStream([...displayStream.getVideoTracks()]);
                } 
                else if (audioOption === "true") {
                    // ØªØ±Ú©ÛŒØ¨ Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ† Ùˆ Ø³ÛŒØ³ØªÙ…
                    const micStream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    const audioCtx = new AudioContext();
                    const dest = audioCtx.createMediaStreamDestination();
                    
                    if (displayStream.getAudioTracks().length > 0) {
                        audioCtx.createMediaStreamSource(displayStream).connect(dest);
                    }
                    audioCtx.createMediaStreamSource(micStream).connect(dest);
                    
                    finalStream = new MediaStream([
                        ...displayStream.getVideoTracks(),
                        ...dest.stream.getAudioTracks()
                    ]);
                }
                // Ø¯Ø± Ø­Ø§Ù„Øª "false" (ÙÙ‚Ø· Ø³ÛŒØ³ØªÙ…)ØŒ Ø®ÙˆØ¯Ú©Ø§Ø± ØµØ¯Ø§ Ø¯Ø§Ø±Ø¯ Ø§Ú¯Ø± Ú©Ø§Ø±Ø¨Ø± ØªÛŒÚ© share audio Ø±Ø§ Ø¨Ø²Ù†Ø¯.

                // Ø´Ø±ÙˆØ¹ Ø¶Ø¨Ø·
                mediaRecorder = new MediaRecorder(finalStream, {
                    mimeType: 'video/webm; codecs=vp9',
                    videoBitsPerSecond: parseInt(document.getElementById('videoQuality').value),
                    // Ø§Ú¯Ø± ØµØ¯Ø§ Ù‚Ø·Ø¹ Ø¨Ø§Ø´Ø¯ØŒ Ø¨ÛŒØªâ€ŒØ±ÛŒØª ØµØ¯Ø§ Ù…Ù‡Ù… Ù†ÛŒØ³Øª
                    audioBitsPerSecond: audioOption === "mute" ? 0 : parseInt(document.getElementById('audioQuality').value)
                });

                mediaRecorder.ondataavailable = e => { if (e.data.size > 0) recordedChunks.push(e.data); };
                
                mediaRecorder.onstop = () => {
                    finalBlob = new Blob(recordedChunks, { type: 'video/webm' });
                    downloadBtn.classList.add('active');
                    downloadBtn.disabled = false;
                    
                    // ØªÙˆÙ‚Ù ØªÙ…Ø§Ù… Ø§Ø³ØªØ±ÛŒÙ…â€ŒÙ‡Ø§ (ØµÙØ­Ù‡ Ùˆ ÙˆØ¨â€ŒÚ©Ù…)
                    finalStream.getTracks().forEach(t => t.stop());
                    if (webcamStream) {
                        webcamStream.getTracks().forEach(t => t.stop());
                        webcamContainer.style.display = 'none';
                    }
                    resetUI();
                };

                mediaRecorder.start();
                startUI();
                
                const limit = parseInt(document.getElementById('timeLimit').value);
                if (limit > 0) setTimeout(() => { if (mediaRecorder.state !== 'inactive') stopBtn.click(); }, limit);

            } catch (e) { 
                console.error(e);
                alert("Ø®Ø·Ø§ Ø¯Ø± Ø´Ø±ÙˆØ¹ Ø¶Ø¨Ø·. Ù„Ø·ÙØ§Ù‹ Ø¯Ø³ØªØ±Ø³ÛŒâ€ŒÙ‡Ø§ Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯."); 
            }
        };

        stopBtn.onclick = () => mediaRecorder.stop();

        pauseBtn.onclick = () => {
            if (mediaRecorder.state === "recording") {
                mediaRecorder.pause();
                pauseBtn.innerText = "â–¶ï¸";
                pauseStartTime = Date.now();
                clearInterval(timerInterval);
            } else if (mediaRecorder.state === "paused") {
                totalPausedTime += (Date.now() - pauseStartTime);
                mediaRecorder.resume();
                pauseBtn.innerText = "â¸";
                resumeTimer();
            }
        };

        // Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø¨Ø§ ÙØ±Ù…Øª Ø§Ù†ØªØ®Ø§Ø¨ÛŒ
        downloadBtn.onclick = () => {
            if(!finalBlob) return;
            const format = document.getElementById('outputFormat').value; // webm, mp4, mkv
            const url = URL.createObjectURL(finalBlob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `ScreenRecord-${new Date().toLocaleTimeString().replace(/:/g,'-')}.${format}`;
            a.click();
        };

        // ØªØºÛŒÛŒØ± Ø´Ú©Ù„ ÙˆØ¨â€ŒÚ©Ù…
        webcamShape.onchange = updateWebcamShape;
        function updateWebcamShape() {
            webcamContainer.className = ''; // Ø±ÛŒØ³Øª Ú©Ù„Ø§Ø³
            webcamContainer.classList.add('shape-' + webcamShape.value);
        }

        // Ù‚Ø§Ø¨Ù„ÛŒØª Ø¬Ø§Ø¨Ø¬Ø§ÛŒÛŒ (Drag & Drop) ÙˆØ¨â€ŒÚ©Ù…
        let isDragging = false;
        let offsetX, offsetY;

        webcamContainer.addEventListener('mousedown', (e) => {
            isDragging = true;
            offsetX = e.clientX - webcamContainer.getBoundingClientRect().left;
            offsetY = e.clientY - webcamContainer.getBoundingClientRect().top;
        });

        document.addEventListener('mousemove', (e) => {
            if (isDragging) {
                webcamContainer.style.left = (e.clientX - offsetX) + 'px';
                webcamContainer.style.top = (e.clientY - offsetY) + 'px';
            }
        });

        document.addEventListener('mouseup', () => {
            isDragging = false;
        });

        function startUI() {
            startBtn.style.display = 'none';
            stopBtn.style.display = 'block';
            pauseBtn.style.display = 'block';
            timerDisplay.style.display = 'block';
            startTime = Date.now();
            resumeTimer();
        }

        function resetUI() {
            startBtn.style.display = 'block';
            stopBtn.style.display = 'none';
            pauseBtn.style.display = 'none';
            timerDisplay.style.display = 'none';
            clearInterval(timerInterval);
            pauseBtn.innerText = "â¸";
        }

        function resumeTimer() {
            timerInterval = setInterval(() => {
                const elapsed = Math.floor((Date.now() - startTime - totalPausedTime) / 1000);
                const m = Math.floor(elapsed / 60).toString().padStart(2, '0');
                const s = (elapsed % 60).toString().padStart(2, '0');
                timerDisplay.innerText = `${m}:${s}`;
            }, 1000);
        }
    </script>
</body>
</html>